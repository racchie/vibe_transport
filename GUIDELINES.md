# 開発ガイドライン＆ルール

本ドキュメントは、「交通費記録アプリ (Vibe Transport)」プロジェクトの開発における、指示方針と作業ルールをまとめたものです。

---

## 1. 一般的な作業方針

### 1.1 明文化と可視化
- **Todo リスト管理**: 内部 Todo リスト＆ `TODO.md` で進捗を追跡。完了済み/未完了を明示。
- **ガイドラインの保持**: 本ファイル（`GUIDELINES.md`）に作業ルールを記載し、プロジェクト内で共有。
- **ドキュメント優先**: 仕様の確認、ガイドのアップデートはコード編集前に行う。

### 1.2 Git ワークフロー
- **コミットメッセージ**: 短く説明的に（例: `chore: add GUIDELINES.md`, `feat: implement Toast component`）。
- **タグ付与**: 新バージョンリリース時に `vX.Y.Z` 形式でタグを作成。
- **README/CHANGELOG 更新**: バージョンアップ時に必ず更新（バージョン番号と `package.json` は同期）。

### 1.3 コード品質
- **TypeScript**: 型安全性を保つため、型チェック（`npx tsc --noEmit`）はコミット前に実行。
- **Linting**: ESLint は本プロジェクトで導入済み（`npm run lint`）。
- **テスト**: 実装後、可能な範囲でユニット/統合テストを追加（将来的な拡張を念頭に）。

---

## 2. UI/UX ガイドライン

### 2.1 トースト通知
- **表示形式**: 登録/削除時に確認メッセージをトースト表示。
- **メッセージテンプレート**: `「登録完了：{日付} {時刻}、{交通機関}で{出発}〜{到着}、{運賃}円」`
- **デフォルト表示時間**: 3.5秒（その後自動消失）。
- **改良予定**: コンポーネント化、複数表示スタック、入出アニメーション、位置/優先度設定を実装予定。

### 2.2 タブ UI
- **配置**: 「新規記録」「よく使う経路」「記録履歴」「データのエクスポート」の 4 タブ。
- **目的**: モバイル画面での垂直スクロール最小化とUX向上。
- **デフォルト**: ページ初期表示時は「新規記録」タブ。

### 2.3 フォーム & モーダル
- **記録編集**: 確認モーダルを表示（更新内容を確認してから確定）。
- **削除**: 確認ダイアログを表示。削除後は「元に戻す」トーストボタンで一定時間内なら復元可能。
- **バリデーション**: 必須項目は明示（`*` マーク）。入力エラー時は alert で通知（将来的にはインラインエラー表示へ）。

### 2.4 ダークモード対応
- **暫定対応**: `dark:` Tailwind CSS クラスで最小限のサポート実施。
- **本対応**: カラー配色ガイド作成後、コントラスト等を全面調整予定。
- **現状**: テキスト色・背景色・ボーダー色に `dark:` クラスを追加（見守られている状態）。

---

## 3. データ管理

### 3.1 ローカルストレージ
- **対象データ**: `travelRecords` と `frequentRoutes` を localStorage に保存。
- **キー名**:
  - `travelRecords`: 交通費記録の配列
  - `frequentRoutes`: よく使う経路の配列
- **初期化**: SSR/CSR の hydration ミスマッチを避けるため、`useEffect` で client mount 後に読み込み。
- **同期**: state 変更時に自動的に localStorage に保存。

### 3.2 データ構造
```typescript
type TravelRecord = {
  id: string;
  date: string; // YYYY-MM-DD
  fromStation: string;
  toStation: string;
  transportationType: 'train' | 'bus';
  transportationCompany?: string;
  fare: number;
};

type FrequentRoute = {
  id: string;
  name: string;
  fromStation: string;
  toStation: string;
  transportationType: 'train' | 'bus';
  transportationCompany?: string;
  fare: number;
};
```

---

## 4. コンポーネント構造

### 4.1 ページレイアウト
- **`src/app/page.tsx`**: メインコンテナ
  - タブ状態管理（`activeTab`）
  - トースト状態管理（`toastMessage`）
  - 記録・経路の CRUD ハンドラー
  - localStorage 同期

### 4.2 主要コンポーネント
- **`TravelExpenseForm`**: 新規記録/編集フォーム
- **`FrequentRoutesList`**: よく使う経路の管理・表示
- **`ExportPanel`**: CSV/XLSX エクスポート機能
- **（今後）`Toast` コンポーネント**: 独立したトースト表示用

### 4.3 実装時の注意
- **Client Component**: `'use client'` ディレクティブを全コンポーネントの先頭に記載。
- **Props 型定義**: Interface で明示的に定義（例: `TravelExpenseFormProps`）。

---

## 5. バージョンと リリース

### 5.1 バージョン管理
- **形式**: Semantic Versioning（`MAJOR.MINOR.PATCH`）。
- **現在**: v0.0.2（初期段階）。
- **同期**: `package.json` version と Git タグを常に一致させる。

### 5.2 リリースフロー
1. 機能実装 & テスト完了
2. `README.md` & `CHANGELOG.md` を更新
3. `package.json` version をバンプ
4. Git コミット＆タグ作成（`git tag vX.Y.Z`）
5. リモートに push（branch と tag）
6. GitHub Release を作成（CHANGELOG 内容を流用）

---

## 6. 日本語標準化

### 6.1 UI テキスト
- **言語**: 日本語を主言語として統一。
- **用語集**:
  - 交通機関: 「電車」「バス」
  - 駅/停留所: 「駅」「バス停」として表記分け（またはフォームで "駅/バス停" と明記）
  - 操作: 「登録」「編集」「削除」「保存」「キャンセル」
  - 確認: 「登録完了」「更新完了」「削除しました」

### 6.2 トースト & エラーメッセージ
- **テンプレート例**: `「{操作完了}: {詳細情報}, {運賃}円」`
- **削除undo**: `「{路線}を削除しました」（元に戻す）`
- **エラー**: `「エラー: {理由}。もう一度試してください。」`

---

## 7. 今後の実装予定 & 注意点

### 7.1 トースト改良（Next Task）
- 独立 Toast コンポーネント化
- 複数トーストのスタック表示
- 入出アニメーション（Fade-in/out 等）
- 位置・タイムアウト・優先度のオプション化

### 7.2 削除の「元に戻す」
- 削除時にデータを一時保存
- トーストに "元に戻す" ボタン表示（5秒以内）
- ボタン押下で削除をロールバック

### 7.3 ダークモード本対応
- 配色ガイドに基づく全面見直し（コントラスト、背景・テキスト色）
- Tailwind の `dark:` クラスを適切に適用
- ライト/ダーク切り替え UI を検討

### 7.4 アクセシビリティ
- タブに ARIA 属性（`aria-selected`, `role="tab"` 等）
- キーボード操作対応（Tab キーでタブ移動）
- スクリーンリーダー対応（`aria-label`, `aria-live`)

### 7.5 SSR/CSR 不一致対策
- `toLocaleString`, `Intl`, `Math.random` 等の自動検出
- 修正提案スクリプト作成

---

## 8. 作業時のチェックリスト

実装・修正を行う前に確認してください：

- [ ] 変更内容を理解し、ガイドラインに沿っているか確認
- [ ] 型チェック: `npx tsc --noEmit`
- [ ] Linting: `npm run lint` （必要に応じて）
- [ ] 手動テスト: ブラウザで動作確認（トースト・タブ・フォーム等）
- [ ] Git: コミットメッセージは明確に、タグが必要なら付与
- [ ] ドキュメント: README/CHANGELOG/TODO.md を更新

---

## 9. 質問・変更があった場合

- 本ガイドラインに反する指示があった場合は、確認のうえ本ファイルを更新。
- 新しいルール・方針が確定したら即座に追記。
- プロジェクトメンバーで確認・共有。

---

**最終更新**: 2025-11-15

